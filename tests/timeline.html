<!DOCTYPE>
<html>
<head>
<title>Timeline test</title>
<link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/dojo/1.12.2/dojo/resources/dojo.css" />
<link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/dojo/1.12.2/dijit/themes/claro/claro.css" />
<link rel="stylesheet" href="/location/css/timeline.css" />
<link rel="stylesheet" href="/location/fonts/fontawesome.css" />
</head>
<body class="claro">

<script>

function storageAvailable(type) {
  try {
    var storage = window[type],
      x = '__storage_test__';
    storage.setItem(x, x);
    storage.removeItem(x);
    return true;
  } catch(e) {
    return e instanceof DOMException && (
        // everything except Firefox
        e.code === 22 ||
        // Firefox
        e.code === 1014 ||
        // test name field too, because code might not be present
        // everything except Firefox
        e.name === 'QuotaExceededError' ||
        // Firefox
        e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
      // acknowledge QuotaExceededError only if there's something already stored
      storage.length !== 0;
  }
}
if(! storageAvailable('localStorage') && ! storageAvailable('sessionStorage')) {
  document.write('<h1>Web Storage API not available</h1><p>This works only with "localStorage" and "sessionStorage" from Web Storage API. Activate or allow that.</p>');
}



locationConfig = { 
	servers : [ ],
	store: '/location/store/', 
	dlm: '/location/lock.php',
	skipCache: true
};
dojoConfig = {
	requestProvider: "dojo/request/xhr",
	parseOnLoad: false,
	isDebug: true,
	locale: 'fr-ch',
	packages: [
		{ name: "artnum", location: "/location/widgets/"}
	]
}
</script>
<script src="https://bitwiseshiftleft.github.io/sjcl/sjcl.js"></script>
<script src="/location/js/dllist.js"></script>
<script src="/location/js/array.js"></script>
<script src="/location/js/date.js"></script>
<script src="/location/js/view.js"></script>
<script src="/location/js/ldap.js"></script>
<!-- https://raw.githubusercontent.com/pieroxy/lz-string/master/libs/lz-string.min.js //-->
<script src="/location/js/lz-string.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/dojo/1.12.2/dojo/dojo.js"></script> 
<script>

require([
	"artnum/timeline",
	"artnum/entry",
	"dojo/request/xhr",
	"dijit/registry",
	"artnum/_Request",
	"dojo/domReady!"
], function (timeline, entry, djXhr, dtRegistry, request) {
var tl = new timeline();
document.getElementsByTagName('body')[0].appendChild(tl.domNode);

request.get('https://airserve01.local.airnace.ch/Airnace/Machines').then(function ( response ) { 
		tl.setServers(locationConfig.servers);
		if(response.success()) {
			tl.beginDraw();
			response.whole().forEach( function ( machine ) {
				var name =  machine.description;
				if(machine.cn && machine.cn.length > 0) {
					name += '<div class="name">' + machine.cn[0] + '</div>'; 	
				}
				var e = new entry({name: name, sup: tl, isParent: true, target: machine.description });
				e.setServers(locationConfig.servers);
				tl.addEntry(e);
				if(machine.airaltref) {
					machine.airaltref[0].split(',').forEach( function (altref ) {
						var e = new entry({name: altref.trim(), sup: tl, isParent: false, target: altref.trim() });
						
						e.setServers(locationConfig.servers);
						tl.addEntry(e);
					});
				}
			});
		}
		tl.endDraw();
	}, function (err) { console.log(err); });
});
</script>
</body>
</html>
